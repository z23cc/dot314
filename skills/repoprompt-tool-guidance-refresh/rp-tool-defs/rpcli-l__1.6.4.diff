60c60
< Start a new chat or continue an existing conversation. Modes: `chat` | `plan` | `edit` | `review`.
---
> Send a message to start or continue a chat conversation.
62,66c62,66
< **Recommended pair‑program loop**
< 1) **Plan** (`mode="plan"`): ask for architecture/steps.
< 2) **Apply**: use `apply_edits` (or `chat_send` with `mode="edit"`) to make the changes.
< 3) **Review** (`mode="review"`): analyze code changes using git diffs of selected files.
< 4) **Repeat** in the **same chat**.
---
> **Modes**: `chat` | `plan` | `edit` | `review`
> - `plan`: Request architecture/implementation steps
> - `edit`: Generate code changes
> - `review`: Analyze code with git diff context
> - `chat`: General conversation (default)
68,72c68,72
< **Critical context hygiene**
< - Run `manage_selection` op=`get` (view="files") to confirm context and tokens.
< - Prefer `set` (or `add`/`remove`) so all **related files** are included.
< - For a full snapshot (prompt, selection, code, tokens; optionally file text/tree), call `workspace_context`.
< - Bias toward **more context over too little**; avoid selecting only one file that references others.
---
> **Session management**:
> - `new_chat`: true to start new session, false to continue
> - `chat_id`: Continue specific chat (optional, defaults to most recent)
> - `chat_name`: Set/update session name (recommended for organization)
> - `model`: Preset ID or name (use `list_models` first)
74,79c74,78
< **Session management**
< - Chats are associated with compose tabs (the bound tab for MCP connections)
< - `new_chat`: true to start; else continues the most recent for the bound tab (or pass `chat_id`)
< - `selected_paths`: replace the selection for this message
< - `chat_name`: optional but **highly recommended** — short, descriptive (e.g., "Fix login crash – auth flow")
< - `model`: preset id/name; call `list_models` first
---
> **Context options**:
> - `selected_paths`: Override selection for this message
> - `git_scope`: "none" | "selected" | "all" - git diff inclusion
> - `git_base`: Base ref for diff (default: HEAD)
> - `use_tab_prompt`: Use compose tab's prompt instead of message
81,85c80,85
< **Limitations**
< - No commands/tests; only sees **selected files** + conversation history
< - For a **snapshot of context** (prompt, selection, codemaps, optional file contents/tree), call `workspace_context`
< 	(add `"files"` in `include` to embed file text). For targeted slices, use `read_file` or `file_search`.
< - The chat does not track its own edit history—after edits, it only sees current file state
---
> **Recommended workflow**:
> 1. Verify context: `manage_selection op=get view=files`
> 2. Plan: `chat_send` with `mode=plan`
> 3. Apply: `apply_edits` or `chat_send mode=edit`
> 4. Review: `chat_send mode=review`
> 5. Continue in same chat for iterative refinement
87c87
< **Note on diffs**: Review mode includes **git diffs** (via `gitInclusion`) showing uncommitted changes. This is separate from edit tracking—git diffs are always available in review mode.
---
> **Limitations**: Chat sees selected files, prompt, and conversation history only. No command execution.
88a89,90
> Related: chats (list/log), manage_selection, workspace_context
> 
130c132
< List chats or view a chat's history. Actions: list | log
---
> List chat sessions or view conversation history.
132,133c134,136
< `list`: recent chats (ID, name, selected files, last activity, tab) — use the ID with `chat_send`
< `log`: full conversation history (optionally include diffs)
---
> **Actions**:
> - `list` (default): Recent sessions with metadata
> - `log`: Full conversation history for a chat
135,140c138,141
< Notes:
< - Chats are associated with compose tabs; `tab_id` is included when available
< - Each chat maintains its own selection and context; continuing restores state
< - `chat_send` without `chat_id` resumes the most recent for the bound tab
< - You can **rename** a session anytime by passing `chat_name` in `chat_send`
< Related: chat_send, workspace_context
---
> **Parameters**:
> - `chat_id`: Required for `log` action
> - `limit`: Max items (list: sessions, log: messages; default: list=10, log=3)
> - `include_diffs`: Include edit diffs in log output
141a143,151
> **Response fields** (list):
> - Chat ID, name, selected files, last activity, bound tab
> 
> **Examples**:
> - List recent: `{"action":"list"}`
> - View history: `{"action":"log","chat_id":"abc123","limit":10}`
> 
> Related: chat_send
> 
162,164c172
< A discovery agent analyzes your codebase, selects relevant files within a token budget, and
< rewrites your instructions into a clarified prompt. For "plan" or "question" modes, this prompt
< is sent to a *separate* model that generates a response—you'll receive a chat_id to continue.
---
> A discovery agent analyzes your codebase, selects relevant files within a token budget, and rewrites your instructions into a clarified prompt.
166c174,180
< **response_type** determines what happens after context is built:
---
> **response_type** (what happens after context building):
> | Type | Behavior |
> |------|----------|
> | (omit) or `clarify` | Context only — returns selection and prompt for you to use |
> | `question` | Answers a question about the codebase using built context |
> | `plan` | Generates implementation plan for the task |
> | `review` | Generates code review with git diff context |
168,170c182,185
< • **Omit or "clarify"**: Context-only. Returns file selection and prompt for YOU to use.
<   Use when: preparing context for an external model, building prompts for chat_send,
<   or gathering context without needing an immediate response.
---
> **Structuring instructions** (XML tags):
> - `<task>`: Main goal
> - `<context>`: Background, constraints, file references
> - `<discovery_agent-guidelines>`: Agent hints only (not passed to follow-up model)
172,173c187,192
< • **"question"**: Answers a question about the codebase using the built context.
<   Use when: you need to understand how something works, find patterns, or investigate code.
---
> **Example**:
> ```
> <task>Add user authentication</task>
> <context>We use JWT tokens. See docs/auth-spec.md for requirements.</context>
> <discovery_agent-guidelines>Focus on src/auth/ and src/middleware/</discovery_agent-guidelines>
> ```
175,176c194
< • **"plan"**: Generates an implementation plan for the task.
<   Use when: the user wants a feature planned, or you need step-by-step implementation guidance.
---
> **Workflow**: Continue with `chat_send(chat_id: "<returned_id>")`. Refine with `manage_selection`.
178,179c196
< • **"review"**: Generates a code review with git diff context.
<   Use when: you want review findings for recent changes.
---
> **Timing**: 30s-5min depending on codebase size and task complexity.
181,191d197
< **Structuring instructions:**
< Use XML tags: `<task>` for the main goal, `<context>` for background/constraints/file references.
< Be detailed—if a spec exists in an .md file, include the path so the agent can read it.
< 
< Use `<discovery_agent-guidelines>` for hints to the discovery agent only (directories to focus on,
< patterns to search, scope constraints). These are not passed to the follow-up model.
< 
< **Workflow:** Continue via chat_send with the returned chat_id. Refine with manage_selection.
< 
< Note: Thorough exploration takes 30s-5min depending on codebase size and task complexity.
< 
211,214c217,221
< Actions:
< - `create`: Create a new file with `content`. Use `if_exists="overwrite"` to replace an existing file. New files are added to the selection.
< - `delete`: Delete a file (absolute path required for safety).
< - `move`: Move/rename to `new_path` (fails if destination exists).
---
> **Actions**:
> - `create`: Create file with `content`. New files are auto-selected.
>   - `if_exists`: "error" (default) | "overwrite"
> - `delete`: Remove file. **Requires absolute path** (prevents ambiguous deletions).
> - `move`: Rename/move to `new_path`. Fails if destination exists. Selection state transfers with file.
216,217c223,226
< Paths: Relative or absolute (`delete` requires absolute). When multiple roots are loaded, you must provide an absolute path when creating files; relative paths are rejected to avoid ambiguity.
< Options: `if_exists` (create): "error" (default) or "overwrite".
---
> **Path handling**:
> - Multi-root: Use absolute path or "RootName/relative/path"
> - Single-root: Relative paths work directly
> - Missing parent directories are created automatically
219c228,232
< Note: Multi-root file creation is supported. Missing intermediate folders are automatically created.
---
> **Examples**:
> - Create: `{"action":"create","path":"src/new.swift","content":"// code"}`
> - Overwrite: `{"action":"create","path":"src/file.swift","content":"// new","if_exists":"overwrite"}`
> - Delete: `{"action":"delete","path":"/Users/me/project/old.swift"}`
> - Move: `{"action":"move","path":"old.swift","new_path":"renamed.swift"}`
241c254
< Search by file path and/or file content.
---
> Search files by path pattern and/or content.
243,248c256,260
< Defaults
< - regex=true (regular expressions by default)
< - case-insensitive
< - spaces match flexible whitespace
< - results use 1‑based line numbers
< - max_results default: 50 (request higher if needed)
---
> **Modes**:
> - `auto` (default): Detects path vs content search from pattern
> - `path`: Match file paths only (glob-style with regex=false, full regex otherwise)
> - `content`: Search inside file contents
> - `both`: Search paths and contents
250,252c262,264
< Response capping
< - The returned payload is capped to ~50k characters.
< - When the cap is hit, we exclude whole results (never cut a line) and report how many were omitted under 'omitted_*' in the response.
---
> **Matching** (regex=true by default):
> - Regex mode: Full regex support (groups, lookarounds, anchors)
> - Literal mode (regex=false): Special chars matched literally, `*`/`?` wildcards for paths
254,259c266,274
< Params
< - pattern (required)
< - regex: true|false
< - mode: "auto" | "path" | "content" | "both" (default "auto")
< - filter: { extensions, exclude, paths }
< - max_results, count_only, context_lines, whole_word
---
> **Key options**:
> - `pattern`: Search term (required)
> - `max_results`: Result limit (default: 50)
> - `context_lines`: Lines before/after matches (alias: `-C`)
> - `whole_word`: Match whole words only
> - `count_only`: Return counts only, no content
> - `filter.extensions`: Limit to extensions (e.g., [".swift"])
> - `filter.paths`: Limit to paths/folders
> - `filter.exclude`: Skip matching patterns
261,263c276,281
< Parameter aliases (for compatibility)
< - `-C`: alias for context_lines (e.g., `-C: 5` same as `context_lines: 5`)
< - `path`: shorthand for single-file search (e.g., `path: "file.swift"` same as `filter: {paths: ["file.swift"]}`)
---
> **Examples**:
> - Literal: `{"pattern":"frame(minWidth:","regex":false}`
> - Regex OR: `{"pattern":"performSearch|searchUsers"}`
> - Find files: `{"pattern":"*.swift","mode":"path","regex":false}`
> - With context: `{"pattern":"TODO","context_lines":2}`
> - Scoped: `{"pattern":"auth","filter":{"paths":["src/auth/"]}}`
265,266c283
< Literal mode (`regex=false`)
< - Special characters are matched literally; no escaping needed
---
> Response capped at ~50k chars; excess results omitted (count reported).
268,280d284
< Regex mode (`regex=true`)
< - Full regular expressions (groups, lookarounds, anchors `^`/`$`); `whole_word` adds word boundaries
< 
< Path search
< - regex=false: `*` and `?` wildcards (match across folders)
< - regex=true: full regex on relative paths
< 
< Examples
< - Literal: {"pattern":"frame(minWidth:", "regex":false}
< - Regex:   {"pattern":"frame\(minWidth:", "regex":true}
< - OR:      {"pattern":"performSearch|searchUsers", "regex":true}
< - Path:    {"pattern":"*.swift", "mode":"path"}
< 
320c324
< Return code structure (codemaps) for files and directories.
---
> Return code structure (function/type signatures) for files.
322,324c326,328
< Scopes:
< - `scope="selected"` — structures for the **current selection** (also lists files without codemaps)
< - `scope="paths"` (default) — pass `paths` (files and/or directories; directories are recursive)
---
> **Scopes**:
> - `paths` (default): Analyze specific files/directories. Requires `paths` parameter.
> - `selected`: Analyze current selection. Also reports files without codemaps.
326c330,332
< Note: Use with `get_file_tree` and `search` to explore before selecting.
---
> **Parameters**:
> - `paths`: File or directory paths (directories are recursive)
> - `max_results`: Limit returned codemaps (default: 25)
327a334,339
> **Note**: Files without parseable structure are skipped. Use with get_file_tree and file_search for discovery.
> 
> **Examples**:
> - Specific files: `{"paths":["src/auth/"]}`
> - Current selection: `{"scope":"selected"}`
> 
342c354
< ASCII directory tree of the project.
---
> Generate ASCII directory tree of the project.
344,351c356,358
< Types:
< - `files` — modes:
< 	- `auto` (default): tries full tree, then trims depth to fit ~10k tokens
< 	- `full`: all files/folders (can be very large)
< 	- `folders`: directories only
< 	- `selected`: only selected files and their parents
< 	Optional: `path` to start from a specific folder; `max_depth` to limit (root=0).
< - `roots` — list root folders.
---
> **Types**:
> - `files` (default): Directory tree with files
> - `roots`: List loaded root folders only
353c360,364
< Files with a codemap are marked `+` in the standard tree.
---
> **Modes** (for type="files"):
> - `auto` (default): Full tree, auto-trims depth if too large (~10k token target)
> - `full`: Complete tree (can be very large)
> - `folders`: Directories only, no files
> - `selected`: Only selected files and their parent directories
354a366,377
> **Options**:
> - `path`: Start from specific folder (modes/max_depth apply from there)
> - `max_depth`: Limit depth (root=0, immediate children=1, etc.)
> 
> **Markers**: `*` = selected file, `+` = has codemap
> 
> **Examples**:
> - Auto tree: `{}`
> - Folders only: `{"mode":"folders"}`
> - Subtree: `{"path":"src/components","max_depth":2}`
> - Selected files: `{"mode":"selected"}`
> 
374c397
< Safe, token-efficient git abstraction for MCP agents.
---
> Safe, read-only git operations.
376,389c399
< Ops:
< - status: Repository state (branch, upstream, ahead/behind, staged/modified/untracked)
< - diff: View changes (summary by default, full on demand, optionally writes artifacts)
< - log: Commit history with stats
< - show: Single commit details
< - blame: Line attribution
< Compare specs (for diff/show):
< - uncommitted (default): Working dir vs HEAD
< - staged: Staged vs HEAD
< - unstaged: Working dir vs staged
< - back:N: HEAD~N..HEAD
< - last: Working dir vs CURRENT snapshot head SHA
< - <snapshot_id>: Working dir vs snapshot head SHA
< - <revspec>: Any git revspec (e.g., main...HEAD)
---
> **Operations**: status | diff | log | show | blame
391,394c401,414
< Detail levels (for diff):
< - summary (default): Totals only
< - files: File list with stats
< - full: Complete patches with hunks
---
> **Compare specs** (for diff/show):
> | Spec | Meaning |
> |------|--------|
> | `uncommitted` | Working dir vs HEAD (default) |
> | `staged` | Staged changes vs HEAD |
> | `unstaged` | Working dir vs staged |
> | `back:N` | HEAD~N..HEAD |
> | `main` | Working dir vs trunk branch (auto-detected) |
> | `uncommitted:main` | Uncommitted vs trunk branch |
> | `staged:main` | Staged vs trunk branch |
> | `trunk` | Alias for `main` |
> | `last` | vs CURRENT snapshot |
> | `<snapshot_id>` | vs specific snapshot |
> | `<revspec>` | Any git revspec |
396,400c416,419
< Repo targeting:
< - Defaults to the first loaded root folder's git repo
< - Use repo_root (path or loaded root name) to target a specific repo
< - Use repo_roots (array of paths or names) for explicit multi-root operations
< - Results include per-repo data and aggregate totals when multiple repos targeted
---
> **Detail levels** (for diff):
> - `summary` (default): Totals only
> - `files`: File list with stats
> - `full`: Complete patches
402c421,425
< Safety: All commands use --no-ext-diff, --no-textconv, --color=never, GIT_TERMINAL_PROMPT=0.
---
> **Publishing artifacts** (`artifacts=true`):
> Writes snapshot files to disk for persistent reference. **Required for chat_send review mode** to include git diff context.
> - Creates MAP.txt, files.tsv, and optional patches
> - `mode`: "quick" | "standard" | "deep" (default: "standard")
> - `scope`: "all" | "selected" — filter to selected files only
403a427,445
> **Repo targeting**:
> - Defaults to first loaded root's repo
> - `repo_root`: Target specific repo (path or name)
> - `repo_roots`: Array for multi-repo operations (status, diff)
> - Tree specifiers: append `@wt` (explicit worktree), `@main` (main checkout), or `@main:<branch>` to target a worktree by branch (local branch name)
> 
> **Safety**: --no-ext-diff, --no-textconv, --color=never, GIT_TERMINAL_PROMPT=0
> 
> **Examples**:
> - Status: `{"op":"status"}`
> - Main checkout status: `{"op":"status","repo_root":"@main"}`
> - Worktree by branch: `{"op":"status","repo_root":"@main:main"}`
> - Diff vs trunk: `{"op":"diff","compare":"main"}`
> - Quick diff: `{"op":"diff","detail":"files"}`
> - Publish for review: `{"op":"diff","artifacts":true,"scope":"selected"}`
> - Recent commits: `{"op":"log","count":5}`
> 
> Note: log/show/blame run on primary repo only with multi-root.
> 
413c455
<     Compare spec for diff/show
---
>     Compare spec for diff/show (supports main/trunk aliases)
467c509
<     root)
---
>     root). Supports @wt, @main, or @main:<branch> suffixes.
471c513
<     operations)
---
>     operations). Supports @wt, @main, or @main:<branch> suffixes.
493c535
< Manage the current selection used by all tools.
---
> Manage the file selection used by all tools.
495,504c537
< Ops: get | add | remove | set | clear | preview | promote | demote
< Options:
< • view="summary"|"files"|"content" (default "summary")
< • path_display="relative"|"full" (default "relative")
< • strict=true|false (default false) — typo/no‑match guard: if a mutation resolves nothing, return a helpful error; set false for no‑op. Note: strict is not all‑or‑nothing—valid inputs still apply and invalid ones are reported.
< • mode="full"|"slices"|"codemap_only" (default "full"):
<   - "full": Complete file content
<   - "slices": Specific line ranges only
<   - "codemap_only": Efficient API structure (function/type signatures) for token savings
<   - Files without an available codemap are skipped and reported as "codemap unavailable" when targeting folders or paths in codemap_only mode.
---
> **Operations**: get | add | remove | set | clear | preview | promote | demote
506,510c539,542
< Automatic Codemap Management:
< • When selecting files with mode="full" or "slices" (via op=add or op=set), auto-adds codemaps for related/dependency files
< • Check complete selection (including auto-codemaps) with op="get" view="files"
< • Manual codemap operations (mode="codemap_only", promote, demote) disable auto-management until you clear
< • Prefer auto-management; only manually manage when you need precise control
---
> **Modes** (how files appear in context):
> - `full` (default): Complete file content
> - `slices`: Specific line ranges only
> - `codemap_only`: API signatures only (function/type definitions)
512,515c544,548
< op=set semantics (mode controls behavior):
< • mode="full": Clears selection, replaces with provided paths/slices (complete reset)
< • mode="slices": File-scoped - adds any paths without clearing, replaces slice definitions only for specified files
< • mode="codemap_only": Replaces codemap-only files, disables auto-management
---
> **Key behaviors**:
> - `op=set` with `mode=full`: Complete selection reset
> - `op=set` with `mode=slices`: File-scoped replacement (only replaces slices for specified files)
> - Auto-codemap: When adding files with `mode=full/slices`, related files get auto-added as codemaps
> - Manual mode: Using `mode=codemap_only`, `promote`, or `demote` disables auto-management
517,527c550,555
< Path Handling:
< • Paths can be files or directories (directories are expanded to all files within, recursively)
< • Paths can be relative (to workspace root) or absolute
< • For single-root workspaces: "src/main.swift" or "Root/src/main.swift" both work
< • For multi-root workspaces: prefix with root name (e.g., "ProjectA/src/main.swift")
< • Fuzzy matching enabled by default - close matches will be resolved
< 
< Guidance:
< • Read files with read_file before slicing to identify relevant sections
< • Use ranges with descriptions for clarity (aliases: description/desc/label)
< • Preview with op="preview" view="files" to see the complete selection (including auto-codemaps) and token counts before committing
---
> **Path handling**:
> - Accepts files or directories (directories expand recursively)
> - Relative or absolute paths accepted
> - Multi-root: prefix with root name (e.g., "ProjectA/src/main.swift")
> - Single-root: prefix optional
> - Fuzzy matching enabled by default
529,535c557,560
< Examples:
< • Add full file: {"op":"add","paths":["Root/src/main.swift"]}
< • Add codemap: {"op":"add","paths":["Root/src/utils/helper.swift"],"mode":"codemap_only"}
< • Set slices (file-scoped): {"op":"set","mode":"slices","slices":[{"path":"Root/src/file.swift","ranges":[{"start_line":45,"end_line":120,"description":"UserAuth flow"}]}]}
< • Add/merge slices: {"op":"add","slices":[{"path":"Root/src/file.swift","ranges":[{"start_line":200,"end_line":250}]}]}
< • Promote codemap→full: {"op":"promote","paths":["Root/src/utils/helper.swift"]}
< • Demote full→codemap: {"op":"demote","paths":["Root/src/utils/helper.swift"]}
---
> **Options**:
> - `view`: "summary" | "files" | "content" | "codemaps" (default: "summary")
> - `path_display`: "relative" | "full" (default: "relative")
> - `strict`: When true, errors if no paths resolve (default: false)
537,542c562,567
< Related:
< • Discover candidates: get_file_tree, file_search
< • Preview structure fast: get_code_structure
< • Snapshot everything: workspace_context
< • Apply changes: apply_edits
< • Chat: chat_send (list/log with chats)
---
> **Examples**:
> - Get selection: `{"op":"get","view":"files"}`
> - Add files: `{"op":"add","paths":["src/main.swift"]}`
> - Add slices: `{"op":"add","slices":[{"path":"file.swift","ranges":[{"start_line":45,"end_line":120}]}]}`
> - Set codemap-only: `{"op":"set","paths":["utils/"],"mode":"codemap_only"}`
> - Promote codemap→full: `{"op":"promote","paths":["helper.swift"]}`
543a569,570
> Related: get_file_tree, file_search, workspace_context, apply_edits
> 
673c700
< Get or modify the shared prompt (instructions/notes). Ops: get | set | append | clear | export | list_presets | select_preset
---
> Get or modify the shared prompt (instructions/notes).
675,677c702
< list_presets: Returns all available copy presets with their configurations.
< select_preset: Changes the active copy preset in the UI. Pass preset (UUID, kind, or name).
< export: Exports clipboard content to a file. Use copy_preset to override which preset is used.
---
> **Operations**: get | set | append | clear | export | list_presets | select_preset
679c704,707
< Related: workspace_context (snapshot), manage_selection (files), chat_send (use prompt), apply_edits.
---
> **Parameters by op**:
> - `set`/`append`: `text` (required)
> - `export`: `path` (required), `copy_preset` (optional override)
> - `select_preset`: `preset` (required) - UUID, kind, or name
680a709,722
> **Notes**:
> - `select_preset` requires an explicitly bound tab context (not available during discovery runs)
> - `export` writes clipboard content to file; use `copy_preset` to override format
> - `list_presets` returns all available copy presets with configurations
> 
> **Examples**:
> - Get: `{"op":"get"}`
> - Set: `{"op":"set","text":"Focus on error handling"}`
> - Export: `{"op":"export","path":"context.txt"}`
> - List presets: `{"op":"list_presets"}`
> - Select preset: `{"op":"select_preset","preset":"mcpBuilder"}`
> 
> Related: workspace_context, manage_selection, chat_send
> 
727c769
< Read file contents, optionally specifying a starting line and number of lines.
---
> Read file contents with optional line range.
729,733c771,774
< Details:
< - 1‑based lines; no params → entire file
< - `start_line` > 0: start at that line (e.g., 10)
< - `start_line` < 0: last N lines (like `tail -n`)
< - `limit`: only with positive `start_line` (e.g., start_line=10, limit=20 → lines 10–29)
---
> **Parameters**:
> - `path`: File path (required)
> - `start_line`: 1-based line number, or negative for tail behavior
> - `limit`: Number of lines (only with positive start_line)
734a776,786
> **Behaviors**:
> - No params: Entire file
> - `start_line=10`: From line 10 to end
> - `start_line=10, limit=20`: Lines 10-29
> - `start_line=-10`: Last 10 lines (like `tail -10`)
> 
> **Examples**:
> - Full file: `{"path":"src/main.swift"}`
> - Lines 50-100: `{"path":"file.swift","start_line":50,"limit":51}`
> - Last 20 lines: `{"path":"file.swift","start_line":-20}`
> 
760,764c812
< Snapshot of this window's workspace: prompt, selection, code structure (codemaps). Larger parts are opt-in.
< Defaults include: prompt, selection, code, tokens.
< include: ["prompt","selection","code","files","tree","tokens"]
< path_display: "relative"|"full"
< copy_preset: Override the copy preset for projection (does not change UI state). Can be a preset UUID, kind (e.g. "standard", "mcpBuilder"), name, or object with id/kind/name.
---
> Snapshot of workspace state: prompt, selection, code structure, tokens.
766c814
< Related: manage_selection (curate selection), prompt (edit instructions), get_file_tree, file_search, get_code_structure, apply_edits, chat_send, chats.
---
> **Default includes**: `["prompt","selection","code","tokens"]`
767a816,835
> **Available includes**:
> - `prompt`: Current prompt text
> - `selection`: Selected files summary
> - `code`: Code structure (codemaps) for selection
> - `files`: Full file contents
> - `tree`: File tree of selected files
> - `tokens`: Token breakdown by component
> 
> **Options**:
> - `include`: Array of sections to include
> - `path_display`: "relative" | "full"
> - `copy_preset`: Override copy preset for token calculation (UUID, kind, or name)
> 
> **Examples**:
> - Default snapshot: `{}`
> - With file contents: `{"include":["prompt","selection","files"]}`
> - Preset override: `{"copy_preset":"mcpBuilder"}`
> 
> Related: manage_selection, prompt, get_file_tree, chat_send
> 
